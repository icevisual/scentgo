## 气味设备程序为 scentrealm_bcc

程序使用方式
> ./scentrealm_bcc --addr="localhost:8383"

参数 addr 代表 websocket 服务器地址，默认 localhost:8383
localhost:8383/scent/controller 会提供 websocket 服务
localhost:8383/ 则是一个测试页面

> 控制器连接 ubuntu 后，会多出来一个 /dev/ttyUSB*
> 由于 tty 属于 dialout 组，需要将当前用户加到 dialout 组
> 比如你的用户名是 username，则
> sudo gpasswd --add username dialout
 
websocket 通讯使用 json 格式的数据
基础的请求格式如下

```json
{
  "cmd": "PlaySmell",
  "params": {
    "smell": 2,
    "duration": 2000,
    "channel": 0
  }
}
```

| 字段       | 说明                                   |
| ---------- | ------------------------------------- |
| cmd        | 请求的指令                             |
| params     | 请求的参数，无参数可没有该字段           |


基础的回复格式如下

```json
{
  "cmd": "PlaySmell",
  "code": 0,
  "error": ""
}
```

| 字段       | 说明                                   |
| ---------- | ------------------------------------- |
| cmd        | 请求的指令                             |
| code       | 操作结果标志位，0 成功，其他失败         |
| error      | 错误信息                               |

  
#### 名词解析


| 名词       | 说明                                                                                            |
| ---------- | ----------------------------------------------------------------------------------------------- |
| 控制器     | 和气味设备通讯的设备，程序通过控制器发出指令来和设备交互                                        |
| 设备编号   | 唯一标识一个气味设备的数字编号，显示在设备侧边                                                  |
| 信道       | 用于将设备分组的一个逻辑概念，取值 0~255，0 信道可控制其他信道的设备                            |
| 气路       | 一个气味设备至多可播放 N 种气味，这 N 个气味用 1~N 来表示                                       |
| 唤醒       | 设备一段时间内未收到控制指令，会进入低功耗休眠状态，需要唤醒后才能再度控制，唤醒耗时 2 秒左右   |

#### 0. 指令列表

大小写敏感


| 指令       | 描述                                                   | 参数 |
| ---------- | ------------------------------------------------------ | ---- |
| Connect    | 连接控制器                                             | 无   |
| Disconnect | 断开控制器                                             | 无   |
| WakeUp     | 唤醒设备                                               | 有   |
| PlaySmell  | 播放气味                                               | 有   |
| StopPlay   | 停止气味播放                                           | 有   |


#### 1. 连接控制器

`PlaySmell`指令， `StopPlay`指令，以及`WakeUp`指令在 blocking = true 时，会自动连接控制器，自动连接时会消耗 1 秒左右的时间

请求示例
```json
{
  "cmd": "Connect"
}
```

#### 2. 断开控制器

请求示例
```json
{
  "cmd": "Disconnect"
}
```
#### 3. 唤醒设备


| 参数       | 描述                                                   | 类型 | 是否必须 | 默认值 | 示例  |
| ---------- | ------------------------------------------------------ | ---- | -------- | ------ | ----- |
| blocking   | blocking为true，唤醒完成后返回 ，否则立即返回          | bool | 否       | true   | true  |


请求示例
```json
{
  "cmd": "WakeUp",
  "params": {
    "blocking": true
  }
}
```

#### 4. 播放气味


| 参数      | 描述                                                   | 类型 | 是否必须 | 默认值 | 示例          |
| --------- | ------------------------------------------------------ | ---- | -------- | ------ | ------------- |
| smell     | 气路编号 ，1~N                                         | int  | 是       |        | 1             |
| duration  | 播放时长，毫秒                                         | int  | 是       |        | 2000，表示2秒 |
| channel   | 信道，0-255                                            | int  | 否       |   0    | 0             |


请求示例
```json
{
  "cmd": "PlaySmell",
  "params": {
    "smell": 2,
    "duration": 2000,
    "channel": 0
  }
}
```


#### 4. 停止播放


| 参数     | 描述                                                   | 类型 | 是否必须 | 默认值 | 示例  |
| -------- | ------------------------------------------------------ | ---- | -------- | ------ | ----- |
| channel  | 信道，0-255                                            | int  | 否       |   0    | 0     |


请求示例
```json
{
  "cmd": "StopPlay",
  "params": {
    "channel": 0
  }
}
```
